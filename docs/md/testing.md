# Testing Strategy

> [!NOTE]
> As of the current version, the test suite is under active development. This document outlines the intended testing strategy.

## Testing Pyramid

We follow the standard testing pyramid:

### 1. Unit Tests (Go)
- **Scope**: Individual functions and methods, mainly in the `internal/application` and `internal/domain` logic (if complex).
- **Tools**: Standard `testing` package, `github.com/stretchr/testify` for assertions and mocks.
- **Mocking**: Interfaces (like `CoinRepository`, `ImageService`) should be mocked to test the `CoinService` logic in isolation without database or filesystem.

```go
// Example Service Test
func TestAddCoin_Success(t *testing.T) {
    mockRepo := new(MockCoinRepo)
    service := NewCoinService(mockRepo, ...)
    // ... assertions
}
```

### 2. Integration Tests
- **Scope**: Interaction between layers, specifically Repository implementations with the real Database.
- **Tools**: `testcontainers-go` is recommended to spin up ephemeral PostgreSQL instances.
- **Focus**: Ensure SQL queries generated by `sqlc` map correctly to the database schema and constraints.

### 3. End-to-End (E2E) Tests
- **Scope**: Full API workflows.
- **Tools**: Can use Go tests sending HTTP requests to a running server instance, or external tools like Postman/Bruno.

## Future Improvements
- [ ] Add unit tests for `CoinService.AddCoin` covering AI failure modes.
- [ ] Add integration tests for `PostgresCoinRepository` to verify complex filters.

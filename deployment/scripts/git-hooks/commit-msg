#!/bin/bash

# Regex for Conventional Commits
# Format: type(scope): subject
# Types: feat, fix, docs, style, refactor, perf, test, build, ci, chore, revert
PATTERN="^(feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert)(\([a-z0-9-]+\))?: .+$"

# Get the commit message file
msg_file="$1"
commit_msg=$(cat "$msg_file")

if ! [[ "$commit_msg" =~ $PATTERN ]]; then
    echo "❌ Error: Invalid commit message format."
    echo "------------------------------------------------------------------"
    echo "Your commit message must follow Conventional Commits standard:"
    echo "  <type>(<scope>): <subject>"
    echo ""
    echo "Examples:"
    echo "  feat: add new search feature"
    echo "  fix(api): handle timeout error"
    echo "  test: add unit tests for login"
    echo ""
    echo "Allowed types: feat, fix, docs, style, refactor, perf, test, build, ci, chore, revert"
    echo "------------------------------------------------------------------"
    exit 1
fi

echo "✅ Commit message format is valid."
exit 0
